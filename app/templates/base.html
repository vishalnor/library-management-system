<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Norens Library System{% endblock %}</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Merriweather:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    />
    <style>
      :root {
        --primary-color: #4a90e2;
        --background-color: #ffffff;
        --text-color: #333333;
        --navbar-bg: #ffffff;
        --navbar-text: #333333;
        --card-bg: #f8f9fa;
      }

      [data-theme="dark"] {
        --primary-color: #61dafb;
        --background-color: #1a1a1a;
        --text-color: #ffffff;
        --navbar-bg: #2c2c2c;
        --navbar-text: #ffffff;
        --card-bg: #2c2c2c;
      }

      body {
        background-color: var(--background-color);
        color: var(--text-color);
      }

      .navbar {
        background-color: var(--navbar-bg);
      }

      .navbar-light .navbar-nav .nav-link {
        color: var(--navbar-text);
      }

      /* Add any other elements that need color changes */

      .navbar-brand {
        font-family: "Merriweather", serif;
        font-weight: 700;
        color: var(--primary-color) !important;
      }

      .nav-link {
        color: var(--text-color) !important;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      .nav-link:hover {
        color: var(--primary-color) !important;
      }

      .navbar-toggler {
        border: none;
        background: transparent !important;
        outline: none;
      }

      .navbar-toggler:focus {
        outline: none;
        box-shadow: none;
      }

      .navbar-toggler .icon-bar {
        display: block;
        width: 22px;
        height: 2px;
        border-radius: 1px;
        margin: 4px 0;
        transition: all 0.2s;
        background-color: var(--primary-color);
      }

      .navbar-toggler.collapsed .icon-bar:nth-child(1) {
        transform: rotate(0) translate(0, 0);
      }

      .navbar-toggler.collapsed .icon-bar:nth-child(2) {
        opacity: 1;
      }

      .navbar-toggler.collapsed .icon-bar:nth-child(3) {
        transform: rotate(0) translate(0, 0);
      }

      .navbar-toggler:not(.collapsed) .icon-bar:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }

      .navbar-toggler:not(.collapsed) .icon-bar:nth-child(2) {
        opacity: 0;
      }

      .navbar-toggler:not(.collapsed) .icon-bar:nth-child(3) {
        transform: rotate(-45deg) translate(4px, -4px);
      }
      .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3e%3cpath stroke='rgba(74, 144, 226, 1)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
      }

      main.container {
        animation: fadeIn 0.5s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .alert {
        position: fixed;
        top: 80px;
        right: 20px;
        max-width: 300px;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease-out;
      }

      .alert.show {
        opacity: 1;
        transform: translateX(0);
      }

      .alert-success {
        background-color: var(--success-color);
        color: #ffffff;
      }

      .alert-danger {
        background-color: var(--error-color);
        color: #ffffff;
      }

      .btn-primary {
        background-color: var(--primary-color);
        border: none;
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        background-color: #3a7bc8;
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .loader {
        border: 3px solid var(--secondary-color);
        border-top: 3px solid var(--primary-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      .navbar-toggler {
        border: none;
        background: transparent !important;
        outline: none;
      }

      .navbar-toggler:focus {
        outline: none;
        box-shadow: none;
      }

      .navbar-toggler .icon-bar {
        display: block;
        width: 22px;
        height: 2px;
        border-radius: 1px;
        margin: 4px 0;
        transition: all 0.2s;
        background-color: var(--primary-color);
      }

      .navbar-toggler:not(.collapsed) .icon-bar:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }

      .navbar-toggler:not(.collapsed) .icon-bar:nth-child(2) {
        opacity: 0;
      }

      .navbar-toggler:not(.collapsed) .icon-bar:nth-child(3) {
        transform: rotate(-45deg) translate(4px, -4px);
      }

      .theme-switch-wrapper {
        display: flex;
        align-items: center;
      }

      .theme-switch {
        display: inline-block;
        height: 34px;
        position: relative;
        width: 60px;
      }

      .theme-switch input {
        display: none;
      }

      .slider {
        background-color: #ccc;
        bottom: 0;
        cursor: pointer;
        left: 0;
        position: absolute;
        right: 0;
        top: 0;
        transition: 0.4s;
      }

      .slider:before {
        background-color: #fff;
        bottom: 4px;
        content: "";
        height: 26px;
        left: 4px;
        position: absolute;
        transition: 0.4s;
        width: 26px;
      }

      input:checked + .slider {
        background-color: var(--primary-color);
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      .slider.round {
        border-radius: 34px;
      }

      .slider.round:before {
        border-radius: 50%;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
    {% block head %}{% endblock %}
  </head>
  <body>
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, message in messages %}
    <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %} {% endif %} {% endwith %}

    <div id="loading-overlay" style="display: none">
      <div class="loader"></div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
      <div class="container">
        <a class="navbar-brand" href="/">Norens Library</a>
        <button
          class="navbar-toggler collapsed"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="/profile"
                ><i class="fas fa-user"></i> Profile</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/cart"
                ><i class="fas fa-book"></i> Borrowed Books</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/search"
                ><i class="fas fa-search"></i> Search Books</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/signin"
                ><i class="fas fa-sign-out-alt"></i> Logout</a
              >
            </li>
            <li class="nav-item">
              <div class="theme-switch-wrapper">
                <label class="theme-switch" for="checkbox">
                  <input type="checkbox" id="checkbox" />
                  <div class="slider round"></div>
                </label>
                <em>Dark Mode</em>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container mt-4">{% block content %}{% endblock %}</main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const loadingOverlay = document.getElementById("loading-overlay");

        // Show loading overlay when a link is clicked
        document.addEventListener("click", function (event) {
          const target = event.target;
          if (
            target.tagName === "A" &&
            !target.getAttribute("href").startsWith("#")
          ) {
            loadingOverlay.style.display = "flex";
          }
        });

        // Hide loading overlay when the page has finished loading
        window.addEventListener("load", function () {
          loadingOverlay.style.display = "none";
        });

        // Hide loading overlay if it's still visible after a certain time (e.g., 5 seconds)
        setTimeout(function () {
          loadingOverlay.style.display = "none";
        }, 5000);

        // Flash messages
        const flashMessages = document.querySelectorAll(".alert");
        flashMessages.forEach((message) => {
          message.classList.add("show");

          // Add close button to each flash message
          const closeBtn = document.createElement("button");
          closeBtn.innerHTML = "&times;";
          closeBtn.className = "close";
          closeBtn.setAttribute("type", "button");
          closeBtn.setAttribute("aria-label", "Close");
          closeBtn.style.position = "absolute";
          closeBtn.style.right = "10px";
          closeBtn.style.top = "50%";
          closeBtn.style.transform = "translateY(-50%)";
          closeBtn.style.background = "none";
          closeBtn.style.border = "none";
          closeBtn.style.fontSize = "20px";
          closeBtn.style.color = "white";
          closeBtn.style.cursor = "pointer";

          closeBtn.onclick = function () {
            message.classList.remove("show");
            setTimeout(() => {
              message.remove();
            }, 300);
          };

          message.appendChild(closeBtn);
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const navbarToggler = document.querySelector(".navbar-toggler");

        navbarToggler.addEventListener("click", function () {
          this.classList.toggle("collapsed");
        });

        // ... (keep your existing code here)
      });

      document.addEventListener("DOMContentLoaded", function () {
        const toggleSwitch = document.querySelector("#checkbox");
        const currentTheme = localStorage.getItem("theme");

        if (currentTheme) {
          document.documentElement.setAttribute("data-theme", currentTheme);

          if (currentTheme === "dark") {
            toggleSwitch.checked = true;
          }
        }

        function switchTheme(e) {
          if (e.target.checked) {
            document.documentElement.setAttribute("data-theme", "dark");
            localStorage.setItem("theme", "dark");
          } else {
            document.documentElement.setAttribute("data-theme", "light");
            localStorage.setItem("theme", "light");
          }
        }

        toggleSwitch.addEventListener("change", switchTheme, false);
      });
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
    {% block scripts %}{% endblock %}
  </body>
</html>
